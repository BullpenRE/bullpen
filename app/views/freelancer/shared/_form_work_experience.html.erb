<div class="modal-body pt-0">

  <div id="alertWarning-<%= freelancer_profile_experience&.id %>" class="d-none">
    <div class="alert alert-warning" role="alert">
      Ending date cannot occur before the starting date.
    </div>
  </div>

  <div class="form-group">
    <label for="companyInput" class="h5">Company</label>
    <%= f.text_field :company, class: "form-control", id: "companyInput", placeholder: "Enter the company name", required: true, value: freelancer_profile_experience&.company %>
  </div>

  <div class="form-group">
    <label for="jobTitleInput" class="h5">Job Title</label>
    <%= f.text_field :job_title, class: "form-control", id: "jobTitleInput", placeholder: "Enter your job title", required: true, value: freelancer_profile_experience&.job_title %>
  </div>

  <div class="form-group">
    <label for="freelancerLocationInput" class="h5">Location</label>
    <%= f.text_field :location, class: "form-control", id: "freelancerLocationInput", placeholder: "e.g. San Francisco, CA", required: true, value: freelancer_profile_experience&.location %>
  </div>

  <div class="form-group">
    <div class="row mb-3">
      <div class="col-12 col-md-6 startDate<%= modal_id %>">
        <div class="d-flex justify-content-between">
          <label for="startMonth" class="h5">Start Date</label> <span class="error_message_start_date<%= modal_id %> text-danger"></span>
        </div>
        <div class="row">
          <div class="col" style="padding-right: 5px;">
            <%= f.select :start_month,
                         options_for_select(
                           select_months_array,
                           freelancer_profile_experience&.start_date&.month),
                         {}, class: 'form-control selectpicker',
                         id: "startMonth-#{modal_id}",
                         required: true, 'data-style': "bp-btn-select",
                         title: "Month" %>
          </div>
          <div class="col" style="padding-left: 5px;">
            <%= f.select :start_year,
                         options_for_select(FreelancerProfileExperience::AVAILABLE_YEARS,
                                            freelancer_profile_experience&.start_date&.year),
                         {}, class: 'form-control selectpicker',
                         id: "startYear-#{modal_id}",
                         required: true, 'data-style': "bp-btn-select",
                         title: "Year" %>
          </div>
        </div>
      </div>
      <div class="col-12 mt-3 col-md-6 mt-md-0 endDate<%= modal_id %> <%= freelancer_profile_experience&.current_job ? 'd-none' : '' %>">
        <div class="d-flex justify-content-between">
          <label for="endMonth-<%= modal_id %>" class="h5">End Date</label> <span class="error_message_end_date<%= modal_id %> text-danger"></span>
        </div>
        <div class="row" id="endDateToggle-<%= freelancer_profile_experience&.id %>">
          <div class="col" style="padding-right: 5px;">
            <%= f.select :end_month,
                         options_for_select(
                           select_months_array,
                           freelancer_profile_experience&.end_date&.month),
                         {}, class: 'form-control selectpicker',
                         id: "endMonth-#{modal_id}",
                         'data-style': "bp-btn-select", title: "Month" %>
          </div>
          <div class="col" style="padding-left: 5px;">
            <%= f.select :end_year,
                         options_for_select(FreelancerProfileExperience::AVAILABLE_YEARS,
                                            freelancer_profile_experience&.end_date&.year),
                         {}, class: 'form-control selectpicker',
                         id: "endYear-#{modal_id}",
                         'data-style': "bp-btn-select", title: "Year" %>
          </div>
        </div>
      </div>
    </div>
    <div class="custom-control custom-checkbox">
      <%= f.check_box :current_job,
                      class: "custom-control-input my-current-job-#{modal_id}",
                      id: "currentJob-#{freelancer_profile_experience&.id}",
                      type: "button",
                      'aria-expanded': "false",
                      'aria-controls': "endDateToggle-#{freelancer_profile_experience&.id}",
                      checked: "#{freelancer_profile_experience&.current_job ? 'checked' : 'false'}",
                      data: { id: modal_id } %>
      <label class="custom-control-label" for="currentJob-<%= freelancer_profile_experience&.id %>">This is
        my current job</label>
    </div>
  </div>

  <div class="form-group mb-0">
    <label for="jobDescriptionTextarea-<%= freelancer_profile_experience&.id %>" class="h5">Description</label>
    <%= f.text_area :description, class: "form-control", id: "editJobDescriptionTextarea", placeholder: "Enter your job description", rows: 3, required: true, value: freelancer_profile_experience&.description %>
  </div>
  <%= f.hidden_field :id, value: freelancer_profile_experience&.id %>
</div>
<% if freelancer_profile_experience&.id.present? %>
  <div class="modal-footer">
    <%= f.submit 'Delete', class: "btn btn-outline-danger mr-2 d-none" %>
    <%= f.submit 'Save Changes', class: "btn btn-primary save-experience-#{modal_id}" %>
  </div>
<% else %>
  <div class="modal-footer justify-content-between">
    <button type="button" class="btn btn-outline-danger mr-2" data-dismiss="modal">Cancel</button>
    <%= f.submit 'Save', id: 'submitWithLocationCheck', class: "btn btn-primary save-experience-#{modal_id}" %>
  </div>
<% end %>

<%= render 'shared/location_check', controller_name: 'work_experience' %>
<script>
    <% if @freelancer_profile && @freelancer_profile.freelancer_profile_experiences&.count > 1 %>
      $('.modal-footer').addClass('justify-content-between');
      $('.btn-outline-danger').removeClass('d-none');
    <% end %>

    $(document).on('turbolinks:load', function () {
      $('#startYear-<%= modal_id %>').selectpicker('refresh');
      $('#startMonth-<%= modal_id %>').selectpicker('refresh');
      $('#endYear-<%= modal_id %>').selectpicker('refresh');
      $('#endMonth-<%= modal_id %>').selectpicker('refresh');

      function toggleEndDate(e) {
        e.preventDefault();

        var currentObjectId = $(e.target).data('id');

        if (currentObjectId === undefined) {
          currentObjectId = '';
        };

        const currentObjectState = $(e.target).is(':checked');
        const currentEndYear = $('#endYear-' + currentObjectId);
        const currentEndMonth = $('#endMonth-' + currentObjectId);

        if (currentObjectState) {
          $('.endDate<%= modal_id %>').addClass('d-none');
          currentEndYear.val('default');
          currentEndMonth.val('default');
          currentEndYear.selectpicker('refresh');
          currentEndMonth.selectpicker('refresh');
        } else {
          currentEndYear.selectpicker('refresh');
          currentEndMonth.selectpicker('refresh');
          $('.endDate<%= modal_id %>').removeClass('d-none');
        }
      };

      $('.my-current-job-<%= modal_id %>').on('change', (e) => {
        toggleEndDate(e)
      });

      $('.save-experience-<%= modal_id %>').on('click', (e) => {
        if ($('#startYear-<%= modal_id %>').val() == '' || $('#startMonth-<%= modal_id %>').val() == '') {
          $('.startDate<%= modal_id %>').addClass('error');
          $('.error_message_start_date<%= modal_id %>').text('Please enter Start Date');
          e.preventDefault();
          e.stopPropagation();
        } else {
          if (!$('.my-current-job-<%= modal_id %>').is(':checked')) {
            if ($('#endYear-<%= modal_id %>').val() == null || $('#endMonth-<%= modal_id %>').val() == null) {
              $('.endDate<%= modal_id %>').addClass('error');
              $('.error_message_end_date<%= modal_id %>').text('Please enter End Date');
              e.preventDefault();
              e.stopPropagation();
            }
          };
        }
      });
    })
</script>

<style>
  select.selectpicker {
    display: block !important;
  }
</style>
