<%= form_for :job_application, url: wizard_path, method: :put, remote: true do |f| %>
<div class="modal-body pt-0">
  <%= f.hidden_field :job_application_id, value: job_application.id %>
  <%= f.hidden_field :job_id, value: job_id %>
  <%= f.hidden_field 'step', value: 'application_step_1' %>
  <div class="mb-3">This offered rate is
    <% if job_application.job.contract_type == 'hourly' %>
      <%= "<b>$#{job_application.job.pay_range_low} - $#{job_application.job.pay_range_high}</b>".html_safe + " per hour" %>
    <% else %>
      <%=  "<b>#{job_application.job.pay_range_low}".html_safe + " for up to " + "<b>#{job_application.job.contract_type.split('_').last}".html_safe + " hours per month"%>
    <% end %>
  </div>
  <div class="form-group mb-1">
    <div class="d-flex justify-content-between">
      <label for="perHourBid" class="h5">What's your bid? <span class="text-dark font-weight-normal">
        <% if job_application.job.contract_type == 'hourly' %>
          <%= "(per hour)" %>
        <% else %>
          <%= "(per month)" %>
        <% end %>
      </span></label>
    </div>
    <div class="row">
      <div class="col col-lg-4">
        <%= f.text_field :bid_amount, class: "form-control", id: "perHourBid", placeholder: "Enter your bid", required: true, value: job_application.bid_amount %>
      </div>
    </div>
  </div>
  <div class="mb-3 net-earnings"> </div>

  <label class="h5">Are you available from 9AM-5PM  <%= job_application.job.time_zone %>?</label>
  <div class="custom-control custom-radio mb-1">
    <%= f.radio_button :available_during_work_hours, 'true', id: "worksHoursRadio1", class: "custom-control-input", required: true %>
    <label class="custom-control-label" for="worksHoursRadio1"><b>Yes</b></label>
  </div>
  <div class="custom-control custom-radio mb-3">
    <%= f.radio_button :available_during_work_hours, 'false', id: "worksHoursRadio2", class: "custom-control-input", required: true %>
    <label class="custom-control-label" for="worksHoursRadio2"><b>No</b></label>
  </div>
  <% if job_application.job.job_questions.present? %>
    <% job_application.job.job_questions.each do |question| %>
      <div class="form-group">
        <div class="d-flex justify-content-between">
          <label for="jobQuestion" class="h5"><%= question.description %></label>
        </div>
        <%= text_area_tag "job_question_#{question.id}", (answers.present? ? answers[question.id] : nil), { class: "form-control", id: "jobQuestion", placeholder: "Enter your response", rows: "5", required: true } %>
      </div>
    <% end %>
  <% end %>
</div>
<div class="modal-footer justify-content-between">
  <button type="button" class="btn btn-outline-primary invisible"><i class="fas fa-chevron-left mr-2"></i>Back</button>
  <%= button_tag type: 'submit', class: "btn btn-primary" do %>
    Next<i class="fas fa-chevron-right ml-2"></i>
  <% end %>
</div>
<% end %>

<script>
  $('#perHourBid').on('input', () => {
    const bid_amount = $('#perHourBid').val();
    const first_symbol = parseInt(bid_amount.charAt(0), 10);
    const length = bid_amount.length;
    const last_symbol = parseInt(bid_amount.charAt(length-1), 10);
    let net_earnings;
    if (isNaN(first_symbol)) {
      net_earnings = parseInt(bid_amount.substring(1,length), 10);
    } else if (isNaN(last_symbol)) {
      net_earnings = parseInt(bid_amount.substring(0,(length-1)), 10);
    } else {
      net_earnings = parseInt(bid_amount, 10);
    }
<!--    let additional_per_hour_fees = <%# job_application.bid_amount / job_application.job.contract_type.split('_').last.to_i %>-->
    // $('.net-earnings').text('Your net earnings will be $' + Math.round(net_earnings*0.7*additional_per_hour_fees +' per month.'));
    $('.net-earnings').text('Your net earnings will be $' + Math.round(net_earnings*0.7 +' per month.'));
  });
</script>

