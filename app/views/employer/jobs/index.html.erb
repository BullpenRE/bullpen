<!--Navigation-->
<nav class="navbar navbar-expand-lg navbar-dark bg-header mb-4">
  <div class="container">
    <a class="navbar-brand" href="https://bullpenre.com/">
      <%= image_pack_tag('media/images/bullpen-logo-white.png', size: '95x30') %>
    </a>
    <div class="collapse navbar-collapse" id="navbarMenu">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a href="#" data-toggle="modal" data-target="#postJobStep1">
            <%= link_to 'Post a job', employer_job_flows_path(start_flow: true), { remote: true, 'data-toggle': "modal", 'data-target': "#postJobStep1", id: "post-job", class: "btn btn-primary mr-2 d-none d-lg-inline-block" } %>
          </a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="#">Freelancer</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Jobs</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Contracts</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Refer a Friend</a>
        </li>
      </ul>
    </div>

    <div class="dropdown">
      <span class="dropdown-toggle d-flex align-items-center" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <i class="fas fa-user-circle bp-profile-placeholder mr-1"></i>
        <span class="mr-1 d-none d-sm-inline text-light"><%= current_user.full_name %></span>
        <i class="fas fa-chevron-down text-primary"></i>
      </span>
      <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown" id="navbar-dropdown">
        <a class="dropdown-item" href="#">Logout</a>
      </div>
    </div>
    <button class="navbar-toggler mr-auto text-light" type="button" data-toggle="collapse" data-target="#navbarMenu" aria-controls="navbarMenu" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button>
  </div>
</nav>

<!--Job card-->
<div class="container mb-3">
  <h1>Jobs</h1>
  <% @jobs.each do |job| %>
    <%= render partial: 'employer/jobs/show_job_post', locals: { job: job } %>
    <div class="bp-card mb-3">
      <div>
        <div class="d-flex flex-column flex-lg-row">
          <div class="mr-auto"><h2 class="text-wrap text-break"><%= job&.title&.capitalize %></h2></div>
          <div class="d-flex flex-column flex-md-row my-2 my-lg-0">
            <% if job.state == 'draft' %>
              <div class="bp-text-sm text-secondary font-weight-bold align-self-md-center align-self-start text-nowrap mr-3">
                Saved as Draft
              </div>
            <% end %>
            <% if job.state == 'posted' %>
              <div class="bp-text-sm text-secondary font-weight-bold align-self-md-center align-self-start mr-3">
                Posted
              </div>
            <% else %>
              <%= link_to 'Post Job', employer_post_job_path(id: job.id), class: "btn btn-primary mr-2" %>
            <% end %>
            <div class="dropdown my-3 my-md-0 align-self-md-center align-self-start">
              <button class="btn btn-outline-primary dropdown-toggle pr-1" type="button" id="dropdownMenu" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                <%= job.state == 'draft' ? 'More' : 'Options' %><i class="fas fa-chevron-down ml-1"></i>
              </button>
              <div class="dropdown-menu dropdown-menu-right" aria-labelledby="dropdownMenu">
                <button class="dropdown-item" type="button"  data-toggle="modal" data-target="#showJobPost<%= job.id %>">Show Job Post</button>
                <%= link_to 'Edit Job Post', employer_job_flows_path(job_id: job.id), { remote: true, 'data-toggle': "modal", 'data-target': "#postJobStep1", class: " dropdown-item" } %>
                <button class="dropdown-item text-danger delete-job-<%= job.id %>" type="button">Delete Job</button>
                <script>
                  $('.delete-job-'+<%= job.id %>).click(() => {
                    Swal.fire({
                      text: "Are you sure?\n",
                      confirmButtonText: `Yes`,
                      showCancelButton: true
                    }).then((result) => {
                      if (result.isConfirmed) {
                        $.ajax({
                          url: '/employer/jobs/<%= job.id %>',
                          method: 'DELETE',
                          success: () => {
                            document.location.reload();
                          }
                        })
                      }
                    });
                  });
                </script>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div>
        <div class="bp-text-sm mb-3">Created <%= time_ago_in_words(job&.created_at) %> ago </div>
        <div class="row">
          <div class="col-lg-8">
            <p class="text-wrap text-break"><%= job.short_description %></p>
            <% job.job_sectors&.each do |job_sector| %>
              <span class="badge badge-secondary mt-1">
               <%= job_sector&.sector&.description %>
              </span>
            <% end %>
            <span class="badge badge-secondary mt-1"><%= job.position_length&.capitalize %></span>
            <span class="badge badge-secondary mt-1"><%= job.hours_needed&.capitalize %></span>
            <div class="bp-text-sm mb-2 mt-3">
             <% if (job.daytime_availability_required == true) %>
              <i class="far fa-clock text-secondary"></i> Daytime availability is required <span class="text-secondary">(9AM-5PM PST)</span>
             <% end %>
            </div>
            <div class="bp-text-sm mb-1">
             <% if (job.required_regional_knowledge.present?) %>
               <i class="fas fa-map-marker-alt text-secondary"></i>  Regional knowledge of <span class="text-secondary"><%= job.required_regional_knowledge %></span> is required
             <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="d-flex d-lg-none mb-3"></div> <!--Shim for mobile views-->
  <% end %>
</div>
<div id="jobStepModal"></div>

<script>
    if (window.innerWidth <= 150) {
        $('#post-job').prop('className','nav-link');
        $('#navbar-dropdown').removeClass('dropdown-menu-right').addClass('dropdown-menu-left');
    };
</script>
